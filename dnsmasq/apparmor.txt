#include <tunables/global>

profile dnsmasq flags=(attach_disconnected,mediate_deleted) {
  #include <abstractions/base>
  #include <abstractions/nameservice>

  capability net_bind_service,
  capability setgid,
  capability setuid,
  capability dac_override,
  network inet raw,
  network inet6 raw,
  capability net_admin,         # for DHCP server
  capability net_raw,           # for DHCP server ping checks

  /bin/busybox ix,
  /bin/bash ix,
  /usr/bin/jq ix,
  /usr/sbin/dnsmasq ix,
  /usr/sbin/arp ix,
  /usr/sbin/ip* ix,

  /etc/dnsmasq.conf rw,
  /data/dnsmasq.leases rw,
  /{,var/}run/*dnsmasq*.pid w,
  /{,var/}run/dnsmasq-forwarders.conf r,
  /{,var/}run/dnsmasq/ r,
  /{,var/}run/dnsmasq/* rw,

  /usr/lib/bashio/bashio ix,
  /dev/tty rw,
  /tmp/* rw,
  /proc/net/* rw,

  /run.sh rix,
  /init rix,
  /data/** rw,
}
